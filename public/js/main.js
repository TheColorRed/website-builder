"use strict";var builder,Elemental;!function(e){async function t(...e){let t="",n={},r=1==e.length?e[0].method:2==e.length?e[0].method:3==e.length?e[2]:"get",a={method:r,headers:{"X-Requested-With":"XMLHttpRequest"}};if(1==e.length?(t=e[0].action,n=new FormData(e[0])):2!=e.length&&3!=e.length||(t=e[0]instanceof HTMLFormElement?e[0].action:e[0],n=e[1]),"get"==r){if(n instanceof FormData){let e=Array.from(n.entries()).map(([e,t])=>encodeURIComponent(e)+"="+encodeURIComponent(t.toString())).join("&");e.length>0&&(t+="?"+e)}else if(n instanceof Object){let e=[];for(let t in n){let r=n[t];r&&e.push(encodeURIComponent(t)+"="+encodeURIComponent(r.toString()))}e.length>0&&(t+="?"+e.join("&"))}}else if(n instanceof FormData)a.body=n;else try{a.body=JSON.stringify(n)}catch(e){a.body=""}let l="",i=document.querySelector("meta[name=csrf]");i&&(l=i.content),l.length>0&&(a.headers["X-CSRF-Token"]=l);try{let e=await fetch(t,a),n=await e.text();try{return JSON.parse(n)}catch(e){return n}}catch(e){console.error(e.message)}return{}}async function n(e){let n="string"==typeof e?document.querySelector(e):e;if(n.reportValidity())return await t(n)}e.toKeyValue=function(e){return Array.from(e).reduce((e,t)=>(e[t.name]=t.value||"",e),{})},e.send=t,e.submit=n,Array.from(document.querySelectorAll("form.ajax")).forEach(t=>{t.addEventListener("submit",async function(t){t.preventDefault();let r=await n(this);if(this.hasAttribute("callback")){let t=this.getAttribute("callback");e[t](r)}})}),e.element=function(e,t){let n;n=e instanceof Elemental.Element?e:new Elemental.Element(e);let r=e.parent;return Elemental.Elemental.DOM_LOADED||Elemental.Elemental.ELEMENTS.push({el:n,loc:r||t}),n}}(builder||(builder={})),builder||(builder={}),Array.from(document.querySelectorAll(".toggle-password")).forEach(e=>{let t=e.querySelector(".toggle"),n=e.querySelector("input[type=password]");t.addEventListener("click",e=>e.preventDefault()),n instanceof HTMLInputElement&&"password"==n.type&&t.addEventListener("click",()=>{n.type="password"==n.type?"text":"password";let e=t.querySelector("i");e&&(e.classList.toggle("fa-eye-slash","text"==n.type),e.classList.toggle("fa-eye","password"==n.type))})}),function(e){function t(e){return e.replace(/[^\w\s]+/g,"").replace(/\s/g,"-").replace(/-$/g,"").toLowerCase()}function n(e){let t=e.checkValidity();e.classList.toggle("required",!t)}let r=document.querySelector("#install");r&&r.addEventListener("click",async t=>{t.preventDefault();let n=await e.submit(r.closest("form"));n.error?alert(n.message):window.location.href=REDIRECT_TO});let a=document.querySelector("#test-connection");a&&a.addEventListener("click",async t=>{let n=document.querySelectorAll("input[name^=db-]"),r=await e.send(TEST_CONN,e.toKeyValue(n),"post");r.error?alert(r.message):alert("Connection successful")});let l=document.querySelector("[name=website-title]"),i=document.querySelector("[name=db-database]");l&&i&&(i.value=t(l.value),l.addEventListener("input",function(){i.classList.contains("sync")&&(i.value=t(l.value))}),i.addEventListener("input",function(){i.classList.remove("sync")}));let o=document.querySelector(".re-sync");if(o&&o.addEventListener("click",e=>{e.preventDefault(),i&&i.classList.add("sync"),i&&l&&(i.value=t(l.value)),n(i)}),r){let e=r.closest("form");e&&Array.from(e.querySelectorAll("text,password,email,number".replace(/\w+/g,"input[type=$&]"))).forEach(e=>{n(e),e.addEventListener("input",function(){this.required&&n(e)})})}}(builder||(builder={})),function(e){e.adminLogin=function(e){e.error||(window.location.href=e.location)}}(builder||(builder={})),function(e){let t=document.getElementById("data-listings");if(t){let l=Array.from(document.querySelectorAll(".media-filter")),i=document.querySelector(".media-query-filter input");async function n(t){let n="";t instanceof HTMLElement?n=t.getAttribute("data-path")||"":"string"==typeof t&&(n=t);let a=await e.send(FILES_URL,{path:n},"get");history.pushState({},"",n?"?path="+n:""),r(a)}function r(n){t.innerHTML="";let r=[];var l,i;n.directories.length>0&&(r.push(e.element({tag:"p.fluid.row.text-bold",children:["span.col-1.text-center Actions","span.col-3 Folder"]})),r.push((l=n.directories,e.element(Elemental.Element.each(l,t=>e.element({tag:"p.fluid.row[data-directory=`${i.directory}`]",children:[{tag:"span.col-1.text-center",children:{tag:"span.margin-right-5",children:[{tag:'a[title="Move to trash"][href=""].trash-delete.red-text',children:"i.fa-lg.fa-fw.far.fa-trash-alt"},{tag:"span.spinner.hidden",children:"i.fa-lg.fa-fw.fas.fa-spin.fa-sync"}]}},{tag:"span.col-3.overflow-ellipsis",children:`a.directory-item[href='?path=${t.directory}'][data-path='${t.directory}'][title='${t.nextDirectory}'] ${t.nextDirectory}`}]})))))),n.files.length>0&&(r.push(e.element({tag:"div",children:[{tag:"p.fluid.row.text-bold",children:["span.col-1.text-center Actions","span.col-3 Filename","span.col-2 Number of Files","span.col-2 Size of Files"]}]})),r.push((i=n.files,e.element({tag:"div",children:[{tag:"p.fluid.row",children:{tag:"span.col-12 0 files have been hidden from the filter",events:{loaded(){a();let e=document.querySelectorAll(".media-file.hidden").length;console.log(e)}}}},Elemental.Element.each(i,t=>e.element({tag:`p.fluid.row.media-file[data-filename='${t.filename}'][data-file='${t.file}'][data-type='${t.metadata.type}']`,children:[{tag:"span.col-1.text-center",children:[{tag:"span.margin-right-5",children:{tag:'a[title="Move to trash"][href=""].trash-delete.red-text',children:"i.fa-lg.fa-fw.far.fa-trash-alt"}},{tag:"span",children:{tag:'a[href=`${i.filename}`][target="_blank"]',children:"i.fa-lg.fa-fw.far.fa-eye"}}]},{tag:"span.col-3.overflow-ellipsis",children:`a[href='${FILE_URL}?file=${t.filename}'][title='${t.filename}'] ${t.file}`},`span.col-2 ${t.files}`,`span.col-2 ${function(e){return e/1024/1024/1024/1024/1024>1?(e/1024/1024/1024/1024/1024).toFixed(2)+" PB":e/1024/1024/1024/1024>1?(e/1024/1024/1024/1024).toFixed(2)+" TB":e/1024/1024/1024>1?(e/1024/1024/1024).toFixed(2)+" GB":e/1024/1024>1?(e/1024/1024).toFixed(2)+" MB":e/1024>1?(e/1024).toFixed(2)+" KB":e+" Bytes"}(t.size)}`]}))]}))));let o=Elemental.Element.join(...r).compile();console.log("c",o.outerHTML),t.appendChild(o)}function a(){let e=l.map(e=>e.classList.contains("active")?e.getAttribute("data-type"):"").filter(String),t=i?i.value:"";Array.from(document.querySelectorAll(".media-file")).forEach(n=>{let r=n.getAttribute("data-type")||"",a=n.getAttribute("data-file")||"";e.includes(r)&&a.includes(t)||a.includes(t)&&0==e.length||e.includes(r)&&0==t.length?n.classList.remove("hidden"):n.classList.add("hidden")})}new MutationObserver(e=>{for(let t of e)t.addedNodes.forEach(e=>{let t=e;t instanceof HTMLElement&&Array.from(t.querySelectorAll(".directory-item")).forEach(e=>{e.addEventListener("click",async function(e){e.preventDefault(),await n(this)})})})}).observe(t,{childList:!0,subtree:!0}),n(((window.location.search.replace(/^\?/,"").split("&").find(e=>e.startsWith("path="))||"").split("=")||[""]).pop()),i&&i.addEventListener("input",e=>{e.preventDefault(),a()}),l.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),a()})}),window.addEventListener("popstate",async t=>{t.preventDefault();let n=window.location.search.replace(/^\?/,"").split("&").find(e=>e.startsWith("path="));n&&(n=n.split("=").pop()),r(await e.send(FILES_URL,{path:n},"get"))}),Array.from(document.querySelectorAll(".directory-item")).forEach(e=>{e.addEventListener("click",async function(e){e.preventDefault(),await n(this)})})}}(builder||(builder={})),function(e){Array.from(document.querySelectorAll(".trash-delete, .trash-restore")).forEach(t=>{let n,r=t.closest("[data-id]");r&&(n=r.querySelector(".spinner")),t.addEventListener("click",async function(t){if(t.preventDefault(),r){n&&n.classList.remove("hidden"),this.classList.add("hidden");let t=r.getAttribute("data-id");if(t&&t.length>0){let n=this.classList.contains("trash-delete")?TRASH_URL:TRASH_RESTORE_URL;await e.send(n,{id:t},"post"),r.remove()}}})})}(builder||(builder={})),HTMLElement.prototype.addEventListeners=function(...e){e[0].split(" ").filter(e=>e.trim().length>0).forEach(t=>{this.addEventListener(t,e[1],e[2])})},function(e){Array.from(document.querySelectorAll(".upload-drag-drop")).forEach(t=>{t.addEventListeners("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListeners("dragover dragenter",function(e){this.classList.add("is-dragover")}),t.addEventListeners("dragleave dragend drop",function(e){this.classList.remove("is-dragover")}),t.addEventListeners("drop",function(n){Array.from(n.dataTransfer.files).forEach(n=>{let r=new FileReader;r.addEventListener("load",async function(r){let a="";if("string"==typeof this.result&&"image"==(a=((this.result.match(/^data:(.+);/)||["",""])[1].split("/")||["",""])[0].trim())){let r=new Image;r.src=this.result;let a=document.querySelector(".upload-preview .preview");a.innerHTML="",a&&a.appendChild(r);let l=new FormData;l.set("path",document.querySelector("input[name=path]").value),l.set("file",n,n.name),await e.send(t,l)}}),r.readAsDataURL(n)})}),t.addEventListener("progress",e=>console.log(e.loaded,e.total));let n=t.querySelector("input[type=file]");if(n){let r=document.querySelector(".upload-preview .preview"),a=Array.from(document.querySelectorAll(".upload-preview .preview-info"));n.addEventListener("change",function(l){n.files instanceof FileList&&Array.from(n.files).forEach(async l=>{let i=new FileReader;i.addEventListener("loadend",async function(e){let t=new Blob([this.result]),n=new Image;n.src=window.URL.createObjectURL(t),r&&(a.forEach(e=>e.classList.add("hidden")),r.classList.remove("hidden"),r.appendChild(n))}),i.readAsArrayBuffer(l);let o=new FormData;o.set("path",document.querySelector("input[name=path]").value),o.set(n.name,l,l.name),await e.send(t,o)})})}})}(builder||(builder={})),function(e){class t{constructor(e){this.el=e}get rootElement(){return this._rootElement}render(e){let n=document.body;e&&"string"==typeof e?n=document.querySelector(e):e instanceof t?n=e.rootElement:e&&e instanceof HTMLElement&&(n=e),n&&(this.el instanceof HTMLElement||this.el instanceof DocumentFragment?this._rootElement=this.el:this._rootElement=this.makeElement(this.el,n))}compile(){let e=document.createDocumentFragment(),t=this.makeElement(this.el,e);return console.log(t.outerHTML),Array.from(t.querySelectorAll("*")).forEach(e=>e.dispatchEvent(new Event("loaded"))),t}static each(e,n){let r=document.createDocumentFragment();for(let t=0;t<e.length;t++){let a=n(e[t],t,e);a.el instanceof HTMLElement||a.el instanceof DocumentFragment?r.appendChild(a.el):r.appendChild(a.makeElement(a.el,r))}return new t(r)}static join(...e){let n=document.createDocumentFragment();for(let t of e){let e=t.el;e instanceof HTMLElement||e instanceof DocumentFragment?n.appendChild(e):n.appendChild(t.makeElement(e,n))}return new t(n)}makeElement(e,t){if(e instanceof DocumentFragment||e instanceof HTMLElement)return t.appendChild(e),e;let n=this.parseQuerySelector("string"==typeof e?e:e.tag||""),r=document.createElement(n.element);if(n.id.length>0&&(r.id=n.id),n.classList.length>0&&r.classList.add(...n.classList),n.attributes.forEach(e=>e.key?r.setAttribute(e.key,e.value):r.setAttribute(e.value,e.value)),n.properties.forEach(e=>r.setAttribute(e,e)),t.appendChild(r),"string"==typeof e)n.text.length>0&&r.appendChild(document.createTextNode(n.text));else{let t=e.txt&&e.txt.length>0?e.txt:n.text.length>0?n.text:"";t.length>0&&r.appendChild(document.createTextNode(t)),this.addEvents(e,r),e&&Array.isArray(e.children)?e.children.forEach(e=>{("boolean"==typeof e.render&&e.render||void 0===e.render)&&this.makeElement(e,r)}):e&&["object","string"].includes(typeof e.children)&&this.makeElement(e.children,r),this.addChildEvents(e,r)}return r.dispatchEvent(new Event("rendered")),r}addEvents(e,t){if(e.events){for(let n in e.events){let r=e.events[n];"function"==typeof r&&t.addEventListener(n,r.bind(t))}t.dispatchEvent(new Event("created"))}}addChildEvents(e,t){if(e.events&&e.events.children){let n=Array.from(t.children);for(let t in e.events.children){let r=e.events.children[t];n.forEach(e=>e.addEventListener(t,r.bind(e)))}n.forEach(e=>e.dispatchEvent(new Event("rendered")))}}parseQuerySelector(e){let t={classList:[],id:"",element:"div",attributes:[],properties:[],text:""};return t.id=(e.match(/#\w+(?![^[]*])/)||[""])[0].replace("#",""),t.classList=(e.match(/\.[\w-_]+(?![^[]*])/g)||[]).map(e=>e.replace(".","")),t.element=e.toLowerCase().split(/[^a-z0-9]/,2)[0]||"div",t.attributes=(e.match(/\[.+?\]/g)||[]).reduce((e,t)=>{let n=t.split("="),r=n.shift(),a=n.join("=");return r=r||"",a=a||"",e.concat({key:r.replace(/^\[|\]$/g,""),value:a.replace(/\]$/g,"").replace(/^('|")/,"").replace(/('|")$/,"")})},[]),t.properties=(e.match(/:\w+(?![^[]*])/g)||[]).reduce((e,t)=>e.concat(t.replace(/^:/,"")),[]),t.text=(e.match(/\s+(?![^[]*]).+/g)||[""])[0].trim(),t}}e.Element=t}(Elemental||(Elemental={})),function(e){class t{}t.DOM_LOADED=!1,t.ELEMENTS=[],e.Elemental=t,document.addEventListener("DOMContentLoaded",()=>{t.DOM_LOADED=!0,t.ELEMENTS.forEach(e=>e.el.render(e.loc))})}(Elemental||(Elemental={}));