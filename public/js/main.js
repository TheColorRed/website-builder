"use strict";var Tagger,builder;function tag(e,t){let n;return n=e instanceof Tagger.Element?e:new Tagger.Element(e)}function $(e){return new Tag(e)}!function(e){class t{constructor(e){this.el=e}get rootElement(){return this._rootElement}render(e){let n=document.body;return e&&"string"==typeof e?n=document.querySelector(e):e instanceof t?n=e.rootElement:e&&e instanceof HTMLElement&&(n=e),n?(this.el instanceof HTMLElement||this.el instanceof DocumentFragment?this._rootElement=this.el:this._rootElement=this.makeElement(this.el,n),n.appendChild(this._rootElement),this._rootElement=n,Array.from(n.querySelectorAll("*")).forEach(e=>e.dispatchEvent(new Event("loaded"))),this):this}compile(){if(this.el instanceof HTMLElement||this.el instanceof DocumentFragment)return this.el;let e=document.createDocumentFragment();return this._rootElement=this.makeElement(this.el,e),this._rootElement}toString(){if(this.rootElement instanceof HTMLElement)return this.rootElement.innerHTML;if(this.rootElement instanceof DocumentFragment){let e=document.createElement("div");for(let t of this.rootElement.children)e.appendChild(t);return e.innerHTML}return""}static each(e,n){let a=document.createDocumentFragment();for(let t=0;t<e.length;t++){let r=n(e[t],t,e);r.el instanceof HTMLElement||r.el instanceof DocumentFragment?a.appendChild(r.el):a.appendChild(r.makeElement(r.el,a))}return new t(a)}static join(...e){let n=document.createDocumentFragment();for(let t of e)t.el instanceof HTMLElement||t.el instanceof DocumentFragment?n.appendChild(t.el):n.appendChild(t.makeElement(t.el,n));return new t(n)}makeElement(e,n){if(e instanceof HTMLElement||e instanceof DocumentFragment)return n.appendChild(e),e;if(e instanceof t){let t=this.makeElement(e.el,n);return n.appendChild(t),e.el instanceof HTMLElement||e.el instanceof DocumentFragment?e.el:t}let a=this.parseQuerySelector("string"==typeof e?e:e.tag||""),r=a.fragment?document.createDocumentFragment():document.createElement(a.element);if(r instanceof HTMLElement&&(a.id.length>0&&(r.id=a.id),a.classList.length>0&&r.classList.add(...a.classList),a.attributes.forEach(e=>e.key?r instanceof HTMLElement&&r.setAttribute(e.key,e.value):r instanceof HTMLElement&&r.setAttribute(e.value,e.value)),a.properties.forEach(e=>r instanceof HTMLElement&&r.setAttribute(e,e))),n.appendChild(r),"string"==typeof e)a.text.length>0&&r.appendChild(document.createTextNode(a.text));else{let t=e.txt&&e.txt.length>0?e.txt:a.text.length>0?a.text:"";t.length>0&&r.appendChild(document.createTextNode(t)),r instanceof HTMLElement&&this.addEvents(e,r),e&&Array.isArray(e.children)?e.children.forEach(e=>{this.makeElement(e,r)}):e&&["object","string"].includes(typeof e.children)&&this.makeElement(e.children,r),r instanceof HTMLElement&&this.addChildEvents(e,r)}return r.dispatchEvent(new Event("rendered")),r}addEvents(e,t){if(e.events){for(let n in e.events){let a=e.events[n];"function"==typeof a&&(t.addEventListener(n,a.bind(t)),"visibility"==n&&new IntersectionObserver(e=>{for(let t of e)t.target.dispatchEvent(new Event(n))}).observe(t))}t.dispatchEvent(new Event("created"))}}addChildEvents(e,t){if(e.events&&e.events.children){let n=Array.from(t.children);for(let t in e.events.children){let a=e.events.children[t];n.forEach(e=>e.addEventListener(t,a.bind(e)))}n.forEach(e=>e.dispatchEvent(new Event("rendered")))}}parseQuerySelector(e){let t={classList:[],id:"",element:"div",fragment:!1,attributes:[],properties:[],text:""},n=e.replace(/\s+(?![^[]*]).+/,"").trim();return t.text=(e.match(/\s+(?![^[]*]).+/)||[""])[0].trim(),t.id=(n.match(/#\w+(?![^[]*])/)||[""])[0].replace("#",""),t.classList=(n.match(/\.[\w-_]+(?![^[]*])/g)||[]).map(e=>e.replace(".","")),t.element=n.toLowerCase().split(/[^a-z0-9]/,2)[0]||"div",(n.startsWith("$frag")||n.startsWith("$fragment"))&&(t.fragment=!0),t.attributes=(n.match(/\[.+?\]/g)||[]).reduce((e,t)=>{let n=t.split("="),a=n.shift(),r=n.join("=");return a=a||"",r=r||"",e.concat({key:a.replace(/^\[|\]$/g,""),value:r.replace(/\]$/g,"").replace(/^('|")/,"").replace(/('|")$/,"")})},[]),t.properties=(n.match(/:\w+(?![^[]*])/g)||[]).reduce((e,t)=>e.concat(t.replace(/^:/,"")),[]),t}}e.Element=t}(Tagger||(Tagger={}));class Tag{constructor(e){this.items=[],e instanceof HTMLElement?this.items.push(e):Array.isArray(e)?this.items=e:"string"==typeof e&&(this.items=Array.from(document.querySelectorAll(e)))}dispatch(e){this.items.forEach(t=>e.split(" ").forEach(e=>t.dispatchEvent(new Event(e))))}broadcast(e){let t=[];this.items.forEach(e=>t.push(...Array.from(e.querySelectorAll("*")))),(t=[...new Set(t)]).forEach(t=>e.split(" ").forEach(e=>t.dispatchEvent(new Event(e))))}count(){return this.items.length}find(e){let t=[];return this.items.forEach(n=>t.push(...Array.from(n.querySelectorAll(e)))),this.items=t,this}closest(e){let t,n=[];return this.items.forEach(a=>(t=a.closest(e))&&n.push(t)),this.items=n,this}remove(){return this.items.forEach(e=>e.remove()),this.items=[],this}addClass(...e){let t=[];return e.forEach(e=>t.push(...e.split(" "))),this.items.forEach(e=>e.classList.add(...t)),this}removeClass(...e){let t=[];return e.forEach(e=>t.push(...e.split(" "))),this.items.forEach(e=>e.classList.remove(...t)),this}static join(...e){return Tagger.Element.join(...e)}static each(e,t){return Array.isArray(e)?Tagger.Element.each(e,t):new Tagger.Element("")}static create(e,t){return tag(e,t)}}!function(e){async function t(...e){let t="",n={},a=1==e.length&&e[0]instanceof HTMLElement?e[0].method:2==e.length&&e[0]instanceof HTMLFormElement?e[0].method:2==e.length&&"string"==typeof e[0]?"get":3==e.length?e[2]:"get",r={method:a,headers:{"X-Requested-With":"XMLHttpRequest"}};if(1==e.length&&e[0]instanceof HTMLFormElement?(t=e[0].action,n=new FormData(e[0])):1==e.length&&"string"==typeof e[0]?(t=e[0],a="get"):2!=e.length&&3!=e.length||(t=e[0]instanceof HTMLFormElement?e[0].action:e[0],n=e[1]),"get"==a){if(n instanceof FormData){let e=Array.from(n.entries()).map(([e,t])=>encodeURIComponent(e)+"="+encodeURIComponent(t.toString())).join("&");e.length>0&&(t+="?"+e)}else if(n instanceof Object){let e=[];for(let t in n){let a=n[t];a&&e.push(encodeURIComponent(t)+"="+encodeURIComponent(a.toString()))}e.length>0&&(t+="?"+e.join("&"))}}else if(n instanceof FormData)r.body=n;else try{r.body=JSON.stringify(n)}catch(e){r.body=""}let i="",s=document.querySelector("meta[name=csrf]");s&&(i=s.content),i.length>0&&(r.headers["X-CSRF-Token"]=i);try{let e=await fetch(t,r),n=await e.text();try{return JSON.parse(n)}catch(e){return n}}catch(e){console.error(e.message)}return{}}async function n(e){let n="string"==typeof e?document.querySelector(e):e;if(n.reportValidity())return await t(n)}e.toKeyValue=function(e){return Array.from(e).reduce((e,t)=>(e[t.name]=t.value||"",e),{})},e.send=t,e.submit=n,Array.from(document.querySelectorAll("form.ajax")).forEach(t=>{t.addEventListener("submit",async function(t){t.preventDefault();let a=await n(this);if(this.hasAttribute("callback")){let t=this.getAttribute("callback");e[t](a)}})})}(builder||(builder={})),builder||(builder={}),Array.from(document.querySelectorAll(".toggle-password")).forEach(e=>{let t=e.querySelector(".toggle"),n=e.querySelector("input[type=password]");t.addEventListener("click",e=>e.preventDefault()),n instanceof HTMLInputElement&&"password"==n.type&&t.addEventListener("click",()=>{n.type="password"==n.type?"text":"password";let e=t.querySelector("i");e&&(e.classList.toggle("fa-eye-slash","text"==n.type),e.classList.toggle("fa-eye","password"==n.type))})}),function(e){function t(e){return e.replace(/[^\w\s]+/g,"").replace(/\s/g,"-").replace(/-$/g,"").toLowerCase()}function n(e){let t=e.checkValidity();e.classList.toggle("required",!t)}let a=document.querySelector("#install");a&&a.addEventListener("click",async t=>{t.preventDefault();let n=await e.submit(a.closest("form"));n.error?alert(n.message):window.location.href=REDIRECT_TO});let r=document.querySelector("#test-connection");r&&r.addEventListener("click",async t=>{let n=document.querySelectorAll("input[name^=db-]"),a=await e.send(TEST_CONN,e.toKeyValue(n),"post");a.error?alert(a.message):alert("Connection successful")});let i=document.querySelector("[name=website-title]"),s=document.querySelector("[name=db-database]");i&&s&&(s.value=t(i.value),i.addEventListener("input",function(){s.classList.contains("sync")&&(s.value=t(i.value))}),s.addEventListener("input",function(){s.classList.remove("sync")}));let l=document.querySelector(".re-sync");if(l&&l.addEventListener("click",e=>{e.preventDefault(),s&&s.classList.add("sync"),s&&i&&(s.value=t(i.value)),n(s)}),a){let e=a.closest("form");e&&Array.from(e.querySelectorAll("text,password,email,number".replace(/\w+/g,"input[type=$&]"))).forEach(e=>{n(e),e.addEventListener("input",function(){this.required&&n(e)})})}}(builder||(builder={})),function(e){e.adminLogin=function(e){e.error||(window.location.href=e.location)}}(builder||(builder={})),function(e){let t=document.getElementById("data-listings");if(t){let o=Array.from(document.querySelectorAll(".media-filter")),c=document.querySelector(".media-query-filter input"),d=window.location.search.replace(/^\?/,"").split("&"),h=(d.find(e=>e.startsWith("path="))||"").match(/(.+?)=(.+)/),f=h&&h[2]?h[2]:"",u=(d.find(e=>e.startsWith("query="))||"").match(/(.+?)=(.+)/);async function n(t){t instanceof HTMLElement?f=t.getAttribute("data-path")||"":"string"==typeof t&&(f=t);let n=await e.send(FILES_URL,{path:f},"get");r(),a(n)}function a(a){t.innerHTML="";let r=[];var s,l;a.directories.length>0&&r.push((s=a.directories,Tag.each(s,t=>tag({tag:"$frag",children:[{tag:"p.fluid.row.text-bold",children:["span.col-1.text-center Actions","span.col-3 Folder"]},{tag:`p.fluid.row[data-directory=${t.directory}]`,children:[{tag:"span.col-1.text-center",children:{tag:"span.margin-horizontal-5",children:[{tag:'a[title="Move to trash"][href=""].trash-delete.red-text',events:{async click(t){t.preventDefault();let n=this.closest("p.row");if(n){let t=n.getAttribute("data-directory");$(this).addClass("hidden").closest(".row").find(".spinner").dispatch("spin"),await e.send(TRASH_URL,{directory:t},"post"),$(this).closest(".row").remove()}}},children:"i.fa-lg.fa-fw.far.fa-trash-alt"},{tag:"span.spinner.hidden",events:{spin(){$(this).removeClass("hidden")}},children:"i.fa-lg.fa-fw.fas.fa-spin.fa-sync"}]}},{tag:"span.col-3.overflow-ellipsis",events:{children:{click(e){e.preventDefault(),n(this)}}},children:`a.directory-item[href='?path=${t.directory}'][data-path='${t.directory}'][title='${t.nextDirectory}'] ${t.nextDirectory}`}]}]})))),a.files.length>0&&r.push((l=a.files,tag({tag:"$frag",children:[{tag:"p.fluid.row.text-bold",children:["span.col-1.text-center Actions","span.col-3 Filename","span.col-2 Number of Files","span.col-2 Size of Files"]},{tag:"p.fluid.row",children:{tag:"span.col-12.filter-count",events:{loaded:()=>$(".filter-count").dispatch("update"),update(){i();let e=$(".media-file.hidden").count();e>0?(this.parentElement&&this.parentElement.classList.remove("hidden"),this.textContent=1==e?`${e} file has`:`${e} files have`,this.textContent+=" been hidden with this filter"):this.parentElement&&this.parentElement.classList.add("hidden")}}}},Tag.each(l,t=>tag({tag:`p.fluid.row.media-file[data-filename='${t.filename}'][data-file='${t.file}'][data-type='${t.metadata.type}']`,events:{visibility:()=>$(".filter-count").dispatch("update")},children:[{tag:"span.col-1.text-center",children:[{tag:"span",children:{tag:'a[title="Move to trash"][href=""].trash-delete.red-text.margin-horizontal-5',events:{async click(t){t.preventDefault();let n=this.closest("p.row");if(n){let t=n.getAttribute("data-filename");$(this).addClass("hidden").closest(".row").find(".spinner, .preview").dispatch("spin hide"),await e.send(TRASH_URL,{file:t},"post"),$(this).closest(".row").remove()}}},children:"i.fa-lg.fa-fw.far.fa-trash-alt"}},{tag:"span.spinner.hidden.margin-horizontal-5",events:{spin(){$(this).removeClass("hidden")}},children:"i.fa-lg.fa-fw.fas.fa-spin.fa-sync"},{tag:"span.preview",events:{hide(){$(this).addClass("hidden")}},children:{tag:`a[href=${t.filename}][target="_blank"].margin-horizontal-5`,children:"i.fa-lg.fa-fw.far.fa-eye"}}]},{tag:"span.col-3.overflow-ellipsis",children:`a[href='${FILE_URL}?file=${t.filename}'][title='${t.filename}'] ${t.file}`},`span.col-2 ${t.files}`,`span.col-2 ${function(e){return e/1024/1024/1024/1024/1024>1?(e/1024/1024/1024/1024/1024).toFixed(2)+" PB":e/1024/1024/1024/1024>1?(e/1024/1024/1024/1024).toFixed(2)+" TB":e/1024/1024/1024>1?(e/1024/1024/1024).toFixed(2)+" GB":e/1024/1024>1?(e/1024/1024).toFixed(2)+" MB":e/1024>1?(e/1024).toFixed(2)+" KB":e+" Bytes"}(t.size)}`]}))]}))),Tag.join(...r).render(t)}u&&u[2]&&(c.value=u[2]),n(f),c&&c.addEventListener("input",e=>{e.preventDefault(),i()}),o.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),i()})}),window.addEventListener("popstate",async t=>{t.preventDefault();let n=window.location.search.replace(/^\?/,"").split("&").find(e=>e.startsWith("path="));n&&(n=n.split("=").pop()),a(await e.send(FILES_URL,{path:n},"get"))});let p=-1,m=!1;function r(){if(m)return;m=!0;let e=l(),t=s(),n=[];f.length>0&&n.push(`path=${f}`),t.length>0&&n.push(`query=${t}`),e.length>0&&n.push(`query=${e.join(",")}`),history.pushState({},"",(n.length>0?"?":window.location.pathname)+n.join("&")),m=!1}function i(){let e=l(),n=s();clearTimeout(p),p=setTimeout(()=>{r(),Array.from(t.querySelectorAll(".media-file")).forEach(t=>{let a=t.getAttribute("data-type")||"",r=t.getAttribute("data-file")||"";e.includes(a)&&r.includes(n)||r.includes(n)&&0==e.length||e.includes(a)&&0==n.length?t.classList.remove("hidden"):t.classList.add("hidden")})},300)}function s(){return c?c.value:""}function l(){return o.map(e=>e.classList.contains("active")?e.getAttribute("data-type"):"").filter(String)}}}(builder||(builder={})),function(e){e.pages||(e.pages={}),"string"==typeof PAGES_URL&&e.send(PAGES_URL).then(e=>{tag({tag:"$frag",children:[{tag:"p.fluid.row.text-bold",children:["span.col-1.text-center Actions","span.col-2 Title","span.col-2 path","span.col-2 Created","span.col-2 Updated"]},Tag.each(e,e=>tag({tag:`p.fluid.row[data-page=${e.path}]`,children:[{tag:"span.col-1.text-center",children:[{tag:"a[href=''].margin-horizontal-5",children:"i.fa-lg.fa-fw.far.fa-edit"},{tag:`a[href='${e.path}'][target='_blank'].margin-horizontal-5`,children:"i.fa-lg.fa-fw.far.fa-eye"},{tag:"a[href=''].margin-horizontal-5.red-text",children:"i.fa-lg.fa-fw.far.fa-trash-alt",events:{click(e){e.preventDefault(),$(this).closest(".row").broadcast("spinnerTrash hideTrash")},hideTrash(){$(this).addClass("hidden")}}},{tag:"span.spinner.margin-horizontal-5.hidden",children:"i.fa-lg.fa-fw.fas.fa-spin.fa-sync",events:{spinnerTrash(){$(this).removeClass("hidden")}}}]},`span.col-2 ${e.title}`,`span.col-2 ${e.path}`,`span.col-2 ${new Date(e.createDate).toLocaleString("en-US")}`,`span.col-2 ${new Date(e.updateDate).toLocaleString("en-US")}`]}))]}).render("#pages")})}(builder||(builder={})),function(e){Array.from(document.querySelectorAll(".trash-delete, .trash-restore")).forEach(t=>{let n,a=t.closest("[data-id]");a&&(n=a.querySelector(".spinner")),t.addEventListener("click",async function(t){if(t.preventDefault(),a){n&&n.classList.remove("hidden"),this.classList.add("hidden");let t=a.getAttribute("data-id");if(t&&t.length>0){let n=this.classList.contains("trash-delete")?TRASH_URL:TRASH_RESTORE_URL;await e.send(n,{id:t},"post"),a.remove()}}})})}(builder||(builder={})),HTMLElement.prototype.addEventListeners=function(...e){e[0].split(" ").filter(e=>e.trim().length>0).forEach(t=>{this.addEventListener(t,e[1],e[2])})},function(e){Array.from(document.querySelectorAll(".upload-drag-drop")).forEach(t=>{t.addEventListeners("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListeners("dragover dragenter",function(){this.classList.add("is-dragover")}),t.addEventListeners("dragleave dragend drop",function(){this.classList.remove("is-dragover")}),t.addEventListeners("drop",function(n){Array.from(n.dataTransfer.files).forEach(n=>{let a=new FileReader;a.addEventListener("load",async function(a){let r="";if("string"==typeof this.result&&"image"==(r=((this.result.match(/^data:(.+);/)||["",""])[1].split("/")||["",""])[0].trim())){let a=new Image;a.src=this.result;let r=document.querySelector(".upload-preview .preview");r.innerHTML="",r&&r.appendChild(a);let i=new FormData;i.set("path",document.querySelector("input[name=path]").value),i.set("file",n,n.name),await e.send(t,i)}}),a.readAsDataURL(n)})}),t.addEventListener("progress",e=>console.log(e.loaded,e.total));let n=t.querySelector("input[type=file]");if(n){let a=document.querySelector(".upload-preview .preview"),r=Array.from(document.querySelectorAll(".upload-preview .preview-info"));n.addEventListener("change",function(i){n.files instanceof FileList&&Array.from(n.files).forEach(async i=>{let s=new FileReader;s.addEventListener("loadend",async function(e){let t=new Blob([this.result]),n=new Image;n.src=window.URL.createObjectURL(t),a&&(r.forEach(e=>e.classList.add("hidden")),a.classList.remove("hidden"),a.appendChild(n))}),s.readAsArrayBuffer(i);let l=new FormData;l.set("path",document.querySelector("input[name=path]").value),l.set(n.name,i,i.name),await e.send(t,l)})})}})}(builder||(builder={}));